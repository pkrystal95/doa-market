# DOA Market 사용자 앱 E2E 테스트 시나리오

## 📋 목차
1. [테스트 개요](#테스트-개요)
2. [테스트 환경 설정](#테스트-환경-설정)
3. [테스트 시나리오](#테스트-시나리오)
4. [테스트 실행 방법](#테스트-실행-방법)
5. [주의사항](#주의사항)

## 테스트 개요

DOA Market 사용자 앱의 주요 기능을 검증하기 위한 E2E (End-to-End) 통합 테스트입니다.

### 테스트 파일 목록

#### 기존 테스트 (4개)
1. **app_flow_test.dart** - 앱 기본 실행 및 UI 인터랙션
2. **mypage_flow_test.dart** - 마이페이지 전체 플로우
3. **product_exploration_test.dart** - 상품 탐색 플로우
4. **purchase_flow_test.dart** - 구매 플로우

#### 신규 테스트 (4개)
5. **review_flow_test.dart** - 리뷰 작성 및 조회 플로우
6. **point_checkin_flow_test.dart** - 포인트 및 출석체크 플로우
7. **notice_inquiry_flow_test.dart** - 공지사항 및 문의 플로우
8. **order_cancel_return_flow_test.dart** - 주문 취소 및 반품 플로우

---

## 테스트 환경 설정

### 필수 요구사항
- Flutter SDK 3.0.0 이상
- 실제 디바이스 또는 에뮬레이터/시뮬레이터
- 백엔드 서버가 실행 중이어야 함

### 의존성 확인
```yaml
dev_dependencies:
  flutter_test:
    sdk: flutter
  integration_test:
    sdk: flutter
  mockito: ^5.4.4
  http_mock_adapter: ^0.6.1
```

### 에뮬레이터 실행
```bash
# iOS 시뮬레이터
flutter emulators --launch apple_ios_simulator

# Android 에뮬레이터
flutter emulators --launch Medium_Phone_API_36.0

# 연결된 디바이스 확인
flutter devices
```

---

## 테스트 시나리오

### 1️⃣ 앱 기본 플로우 (app_flow_test.dart)

**테스트 케이스:**
- ✅ 앱 시작 및 스플래시 화면 표시
- ✅ 로그인 화면 UI 요소 확인
- ✅ 네비게이션 테스트
- ✅ 텍스트 입력 필드 상호작용
- ✅ 버튼 탭 인터랙션
- ✅ Provider 상태 관리 테스트

**목표:** 앱이 정상적으로 시작되고 기본 UI가 올바르게 렌더링되는지 확인

---

### 2️⃣ 마이페이지 플로우 (mypage_flow_test.dart)

**시나리오:** 로그인 → 마이페이지 → 프로필 수정 → 주문내역 → 배송지 → 찜목록 → 로그아웃

**테스트 케이스:**
1. **로그인 확인**
   - 로그인 화면 진입
   - 테스트 계정으로 로그인 (test@test.com / Test1234!)

2. **마이페이지 진입**
   - BottomNavigationBar의 프로필 탭 클릭
   - 마이페이지 화면 확인

3. **프로필 정보 확인 및 수정**
   - 프로필 수정 버튼 클릭
   - 이름 변경
   - 저장 버튼 클릭

4. **주문 내역 조회**
   - 주문내역 버튼 클릭
   - 필터 옵션 테스트 (전체, 배송중, 배송완료)
   - 주문 상세 확인

5. **배송지 관리**
   - 배송지 관리 버튼 클릭
   - 새 배송지 추가
   - 배송지 목록 확인

6. **찜 목록 확인**
   - 찜한 상품 조회
   - 장바구니 담기 기능 테스트

7. **회원 등급 및 포인트 확인**
   - 등급 정보 확인
   - 포인트 정보 확인

8. **로그아웃**
   - 로그아웃 버튼 클릭
   - 로그아웃 완료 확인

---

### 3️⃣ 상품 탐색 플로우 (product_exploration_test.dart)

**시나리오:** 홈 → 카테고리 → 검색 → 상품상세 → 찜하기 → 장바구니

**테스트 케이스:**
1. **홈 화면 상품 목록**
   - 상품 그리드 뷰 확인
   - 새로고침 기능 테스트

2. **카테고리별 상품 조회**
   - 카테고리 탭 이동
   - 카테고리 목록 확인
   - 카테고리별 필터링

3. **상품 검색**
   - 검색 화면 진입
   - 검색어 입력 (스마트폰, 노트북)
   - 검색 결과 확인
   - 인기 검색어 확인

4. **상품 상세 보기**
   - 상품 카드 클릭
   - 상품 이미지 확인
   - 수량 선택 기능 테스트

5. **찜하기 기능**
   - 하트 아이콘 클릭
   - 찜 추가/해제 토글
   - 찜 목록에서 확인

6. **장바구니 담기**
   - 장바구니 버튼 클릭
   - 장바구니에서 상품 확인
   - 수량 변경 테스트

---

### 4️⃣ 구매 플로우 (purchase_flow_test.dart)

**시나리오:** 회원가입 → 상품검색 → 장바구니 → 결제 → 주문확인

**테스트 케이스:**
1. **회원가입**
   - 회원가입 버튼 클릭
   - 이메일, 비밀번호, 이름 입력
   - 회원가입 완료

2. **홈 화면 진입**
   - 홈 화면 표시 확인

3. **상품 검색**
   - 검색 아이콘 클릭
   - 검색어 입력
   - 검색 실행

4. **상품 선택 및 장바구니 추가**
   - 상품 카드 클릭
   - 장바구니 추가 버튼 클릭

5. **장바구니 화면**
   - 장바구니 아이콘 클릭
   - 장바구니 상품 확인

6. **결제 진행**
   - 결제하기 버튼 클릭
   - 결제 화면 진입 확인

7. **주문 내역 확인**
   - 마이페이지 진입
   - 주문내역 조회

---

### 5️⃣ 리뷰 플로우 (review_flow_test.dart)

**시나리오:** 주문내역 → 리뷰 작성 → 나의 리뷰 조회 → 리뷰 수정

**테스트 케이스:**
1. **주문 내역에서 리뷰 작성 버튼 찾기**
   - 배송완료 주문 필터
   - 주문 상세 진입
   - 리뷰 작성 버튼 클릭

2. **리뷰 작성**
   - 별점 선택 (5점)
   - 리뷰 제목 입력
   - 리뷰 내용 입력
   - 리뷰 제출

3. **나의 리뷰 조회**
   - 마이페이지에서 나의 리뷰 메뉴 클릭
   - 작성한 리뷰 목록 확인
   - 리뷰 상세 보기

4. **상품 상세에서 리뷰 조회**
   - 상품 페이지 진입
   - 리뷰 탭 확인
   - 다른 사용자 리뷰 확인

5. **리뷰 수정**
   - 리뷰 수정 버튼 클릭
   - 리뷰 내용 수정
   - 저장

---

### 6️⃣ 포인트 및 출석체크 플로우 (point_checkin_flow_test.dart)

**시나리오:** 출석체크 → 포인트 적립 → 포인트 내역 → 포인트 사용

**테스트 케이스:**
1. **현재 포인트 확인**
   - 마이페이지에서 포인트 정보 확인
   - 회원 등급 확인

2. **출석체크 실행**
   - 출석체크 화면 진입
   - 출석체크 달력 확인
   - 출석하기 버튼 클릭
   - 연속 출석일 확인

3. **포인트 내역 조회**
   - 포인트 내역 메뉴 클릭
   - 적립/사용 내역 확인
   - 필터 옵션 테스트 (전체, 적립, 사용)

4. **포인트 사용 시나리오**
   - 상품 선택 및 장바구니 담기
   - 결제 화면에서 포인트 사용 옵션 확인
   - 포인트 입력 (1000원)

5. **포인트 예정 정보**
   - 적립 예정 포인트 확인
   - 소멸 예정 포인트 확인

6. **연속 출석 보너스**
   - 연속 출석 보너스 정보 확인
   - 출석 달성 현황 확인

---

### 7️⃣ 공지사항 및 문의 플로우 (notice_inquiry_flow_test.dart)

**시나리오:** 공지사항 조회 → 1:1 문의 작성 → 문의 내역 확인

**테스트 케이스:**
1. **공지사항 목록 조회**
   - 공지사항 메뉴 클릭
   - 카테고리 필터 (전체, 중요, 이벤트, 업데이트)
   - 공지사항 목록 확인

2. **공지사항 상세 보기**
   - 공지사항 카드 클릭
   - 제목 및 내용 확인
   - 이미지/첨부파일 확인

3. **1:1 문의 목록**
   - 1:1 문의 메뉴 클릭
   - 기존 문의 목록 확인
   - 상태 필터 (전체, 답변대기, 답변완료)

4. **새 문의 작성**
   - 문의 작성 버튼 클릭
   - 문의 유형 선택 (상품문의)
   - 문의 제목 및 내용 입력
   - 이메일 알림 수신 체크
   - 문의 등록

5. **작성한 문의 확인**
   - 문의 목록에서 확인
   - 문의 상세 보기
   - 답변 상태 확인

6. **문의 수정 및 삭제**
   - 답변대기 상태의 문의 선택
   - 수정 버튼 클릭
   - 내용 수정 및 저장

7. **FAQ 확인**
   - FAQ 메뉴 진입
   - 카테고리 확인 (배송, 결제, 취소/환불, 회원정보)
   - FAQ 항목 열기

---

### 8️⃣ 주문 취소 및 반품 플로우 (order_cancel_return_flow_test.dart)

**시나리오:** 주문 취소 신청 → 반품 신청 → 교환 신청

**테스트 케이스:**

#### 주문 취소 플로우
1. **취소 가능한 주문 찾기**
   - 주문내역 조회
   - 결제완료/배송준비중 필터
   - 주문 상세 진입

2. **주문 취소 신청**
   - 주문 취소 버튼 클릭
   - 취소 사유 선택 (단순 변심)
   - 취소 상세 사유 입력
   - 환불 방법 확인
   - 환불 예정 금액 확인
   - 취소 신청 완료

3. **취소 내역 확인**
   - 취소 필터 적용
   - 취소된 주문 목록 확인

#### 반품 신청 플로우
1. **반품 가능한 주문 찾기**
   - 배송완료 주문 필터
   - 주문 상세 진입

2. **반품 신청**
   - 반품 신청 버튼 클릭
   - 반품 사유 선택 (상품 불량)
   - 반품 상세 사유 입력
   - 반품 사진 첨부 옵션 확인
   - 수거지 정보 확인
   - 환불/교환 방법 선택
   - 반품 비용 안내 확인
   - 반품 신청 완료

3. **반품 내역 확인**
   - 반품 필터 적용
   - 반품 진행 상태 확인
   - 택배사 정보 확인

#### 교환 신청 플로우
1. **교환 신청**
   - 교환 신청 버튼 클릭
   - 교환 옵션 선택 (사이즈, 색상)
   - 교환 사유 입력
   - 교환 신청 완료

---

## 테스트 실행 방법

### 개별 테스트 실행

```bash
# iOS에서 실행
flutter test integration_test/app_flow_test.dart -d apple_ios_simulator

# Android에서 실행
flutter test integration_test/app_flow_test.dart -d emulator-5554

# 특정 디바이스 지정
flutter test integration_test/review_flow_test.dart -d <device_id>
```

### 전체 테스트 실행

```bash
# 모든 통합 테스트 실행
flutter test integration_test/

# 타임아웃 설정 (5분)
flutter test integration_test/ --timeout 5m
```

### 테스트 결과 확인

테스트가 성공하면 다음과 같은 메시지가 출력됩니다:
```
✅✅✅ [테스트명] 전체 플로우 테스트 완료! ✅✅✅
```

---

## 주의사항

### ⚠️ 현재 알려진 이슈

1. **Finder의 `.or()` 메서드 오류**
   - Flutter의 Finder는 `.or()` 메서드를 지원하지 않음
   - 신규 작성된 테스트 파일에서 `.or()` 사용 부분 수정 필요
   - 해결 방법: 조건부 로직으로 여러 Finder를 순차적으로 확인

2. **백엔드 서버 연동**
   - 테스트 실행 전 백엔드 서버가 실행 중이어야 함
   - 테스트 데이터가 DB에 존재해야 함
   - 네트워크 지연으로 인한 타임아웃 발생 가능

3. **테스트 데이터**
   - 테스트 계정: `test@test.com` / `Test1234!`
   - 테스트 실행 전 해당 계정 생성 필요
   - 일부 테스트는 주문 내역, 상품 데이터 등이 필요

### 🔧 권장 사항

1. **테스트 환경 분리**
   - 개발/스테이징 환경에서 테스트 실행
   - 프로덕션 환경에서는 테스트 실행 금지

2. **테스트 순서**
   - 기본 플로우 테스트부터 순차적으로 실행
   - 의존성이 있는 테스트는 순서 고려

3. **디버깅**
   - 테스트 실패 시 `print` 문으로 진행 상황 확인
   - `pumpAndSettle`의 timeout 조정
   - 스크린샷 캡처 기능 활용

### 📊 테스트 커버리지

현재 E2E 테스트로 커버되는 주요 기능:
- ✅ 회원가입/로그인/로그아웃
- ✅ 상품 탐색 (홈, 카테고리, 검색)
- ✅ 상품 상세
- ✅ 장바구니
- ✅ 찜 목록
- ✅ 결제 프로세스
- ✅ 주문 관리 (주문내역, 취소, 반품, 교환)
- ✅ 리뷰 작성 및 조회
- ✅ 마이페이지 (프로필, 배송지, 포인트)
- ✅ 출석체크
- ✅ 공지사항
- ✅ 1:1 문의

---

## 📝 테스트 작성 가이드

새로운 E2E 테스트를 작성할 때 따라야 할 패턴:

```dart
import 'package:flutter/material.dart';
import 'package:flutter_test/flutter_test.dart';
import 'package:integration_test/integration_test.dart';
import 'package:doa_market_user/main.dart' as app;

void main() {
  IntegrationTestWidgetsFlutterBinding.ensureInitialized();

  group('테스트 그룹명', () {
    testWidgets('테스트 케이스 설명', (WidgetTester tester) async {
      // 앱 시작
      app.main();
      await tester.pumpAndSettle(const Duration(seconds: 3));

      // 테스트 로직 작성
      print('🔹 Step 1: 단계 설명');

      final button = find.text('버튼 텍스트');
      if (button.evaluate().isNotEmpty) {
        await tester.tap(button);
        await tester.pumpAndSettle();
        print('✅ 단계 완료');
      }

      // 검증
      expect(find.byType(MaterialApp), findsOneWidget);
      print('\n✅✅✅ 테스트 완료! ✅✅✅\n');
    });
  });
}
```

---

## 🔗 참고 자료

- [Flutter Integration Testing 공식 문서](https://docs.flutter.dev/testing/integration-tests)
- [WidgetTester API](https://api.flutter.dev/flutter/flutter_test/WidgetTester-class.html)
- [Finder API](https://api.flutter.dev/flutter/flutter_test/CommonFinders-class.html)
